---
title: "ACS Data"
author: "Madeline Chang"
date: "2025-11-01"
output: pdf_document
editor_options: 
  chunk_output_type: console
---

## Calling in libraries

```{r setup, include=FALSE}
library(dplyr)
library(tidyverse)
library(ggplot2)
library(janitor)
library(lubridate)
library(googlesheets4)
library(rlang)
library(gridExtra)
library(corrplot)
library(forcats)
library(stats)
library(mosaic)
library(knitr)
library(weights)
library(Hmisc)
library(corrplot)

library(tidycensus)
```

## Reading in the data 

```{r}
pums_data<- read.csv('/Users/mtc/ADS/ADS 599/599 Project/pums_data.csv')
```

## Adjusting indicator variables so that No = 0 and Yes = 1

```{r}
bin_fix<- c('DDRS', 'DEAR', 'DEYE', 'DOUT', 'DPHY', 'DREM', 'HINS1', 'HINS2', 'HINS3', 'HINS4', 'HINS5', 'HINS6', 'HINS7', 'DIS')

for(label in bin_fix){
  pums_data[[label]] <- ifelse(pums_data[[label]] == 2, 0, 1)
}
```


## Creating derived variables

```{r}
pums_data_col<- pums_data %>%
  mutate(SCHL = as.factor(SCHL)) %>%
  mutate(edu_cat = fct_collapse(SCHL, up_to_grade= c('1', '2', '3', '4', '5', '6', '7', '8'),
                                middle = c('9', '10', '11'),
                                some_hs = c('12', '13', '14', '15'),
                                hs_dip_equiv = c('16', '17'),
                                some_coll = c('18', '19'),
                                assoc_bach = c('20', '21'),
                                masters_pl = c('22', '23', '24')),
         COW_desc = case_when(COW == 1 ~ "for_profit_or_ind",
                              COW == 2 ~ "not_profit",
                              COW == 3 ~ "local_gov",
                              COW == 4 ~ "state_gov",
                              COW == 5 ~ "fed_gov",
                              COW == 6 ~ "self_not_incorp",
                              COW == 7 ~ "self_incorp",
                              COW == 8 ~ "family_bus_wo_pay",
                              COW == 9 ~ "unemp",
                              COW == 'b' ~ "not_labor_force"))
```




## Summary statistics (weighted) of total income by sex, disability, and education attainment

```{r}
pums_data_col %>%
  group_by(SEX_label, DIS_label, edu_cat) %>%
  summarise(min = wtd.quantile(PINCP, weight = PWGTP, probs=c(0)),
            q1 = wtd.quantile(PINCP, weight = PWGTP, probs=c(0.25)),
            median = wtd.median(PINCP, weight = PWGTP),
            q3 = wtd.quantile(PINCP, weight = PWGTP, probs=c(0.75)),
            max = wtd.quantile(PINCP, weight = PWGTP, probs=c(1)),               
            mean = weighted.mean(PINCP, w=PWGTP),
            count = sum(PWGTP)
)
```


## Weighted boxplots of total income and earnings in the last 12 months by educational attainment and disability

```{r}
ggplot(data = pums_data_col, weight = PWGTP) +
  geom_boxplot(aes(x = edu_cat, y = PINCP, fill = DIS_label)) +
  labs(x = 'Educational Attainment', y = 'Total Income', fill = "Disability Status", title = "Total Income by Educational Attainment")

ggplot(data = pums_data_col, weight = PWGTP) +
  geom_boxplot(aes(x = edu_cat, y = WAGP, fill = DIS_label)) +
  labs(x = 'Educational Attainment', y = 'Income from Last 12 Months', fill = "Disability Status", title = "Income from Last 12 Months by Educational Attainment")
```

## Barplots of Disabilty Difficulty by Educational Attainment

```{r}
disabled<- pums_data_col %>%
  pivot_longer(cols = c(DDRS_label, DEAR_label, DEYE_label, DOUT_label, DPHY_label, DREM_label), names_to = "difficulty", values_to = "value") %>%
  filter(value == "Yes") %>%
  mutate(difficulty = case_when(difficulty == "DDRS_label"~ "self care",
                                difficulty == "DEAR_label" ~ "hearing",
                                difficulty == "DEYE_label" ~ "vision",
                                difficulty == "DOUT_label" ~ "independent living",
                                difficulty == "DPHY_label"~ "ambulatory",
                                difficulty == "DREM_label"~ "cognitive"))

disabled %>%
  ggplot() +
  geom_bar(aes(x = difficulty, fill = edu_cat), position = "dodge") +
  labs(x = "Difficulty", y = "Count", fill = "Educational Attainment", title = "Count of Disability Difficulty by Educational Attainment")

```

## Barplots of Disabilty Difficulty by Type of Work

```{r}
disabled %>%
  filter(difficulty == "self care") %>%
  ggplot(weight = PWGTP) +
  geom_bar(aes(x = COW_desc, fill =SEX_label), position = "dodge") +
  labs(x = "Type of Work", y = "Count", fill = "Sex", title = "Count of Type of Work with Self Care Difficulty") +
  coord_flip()

disabled %>%
  filter(difficulty == "hearing") %>%
  ggplot(weight = PWGTP) +
  geom_bar(aes(x = COW_desc, fill =SEX_label), position = "dodge") +
  labs(x = "Type of Work", y = "Count", fill = "Sex", title = "Count of Type of Work with Hearing Difficulty") +
  coord_flip()

disabled %>%
  filter(difficulty == "vision") %>%
  ggplot(weight = PWGTP) +
  geom_bar(aes(x = COW_desc, fill =SEX_label), position = "dodge") +
  labs(x = "Type of Work", y = "Count", fill = "Sex", title = "Count of Type of Work with Vision Difficulty") +
  coord_flip()

disabled %>%
  filter(difficulty == "ambulatory") %>%
  ggplot(weight = PWGTP) +
  geom_bar(aes(x = COW_desc, fill =SEX_label), position = "dodge") +
  labs(x = "Type of Work", y = "Count", fill = "Sex", title = "Count of Type of Work with Ambulatory Difficulty") +
  coord_flip()

disabled %>%
  filter(difficulty == "independent living") %>%
  ggplot(weight = PWGTP) +
  geom_bar(aes(x = COW_desc, fill =SEX_label), position = "dodge") +
  labs(x = "Type of Work", y = "Count", fill = "Sex", title = "Count of Type of Work with Independent Living Difficulty") +
  coord_flip()

disabled %>%
  filter(difficulty == "cognitive") %>%
  ggplot(weight = PWGTP) +
  geom_bar(aes(x = COW_desc, fill =SEX_label), position = "dodge") +
  labs(x = "Type of Work", y = "Count", fill = "Sex", title = "Count of Type of Work with Cognitive Difficulty") +
  coord_flip()

```


## Barplots by Educational Attainment

```{r}
disabled %>%
  mutate(SCHL = as.numeric(SCHL)) %>%
  filter(SCHL >= 1 & SCHL <= 15) %>%
  ggplot(weight = PWGTP) +
  geom_bar(aes(x = edu_cat, fill = COW_desc), position = "dodge") +
  labs(x = "Educational Attainment", y = "Count", title = "Educational Attainment by Type of Work for Disabled Individuals")

disabled %>%
  mutate(SCHL = as.numeric(SCHL)) %>%
  filter(SCHL >= 16 & SCHL <= 19) %>%
  ggplot(weight = PWGTP) +
  geom_bar(aes(x = edu_cat, fill = COW_desc), position = "dodge") +
  labs(x = "Educational Attainment", y = "Count", title = "Educational Attainment by Type of Work for Disabled Individuals")

disabled %>%
  mutate(SCHL = as.numeric(SCHL)) %>%
  filter(SCHL > 19) %>%
  ggplot(weight = PWGTP) +
  geom_bar(aes(x = edu_cat, fill = COW_desc), position = "dodge") +
  labs(x = "Educational Attainment", y = "Count", title = "Educational Attainment by Type of Work for Disabled Individuals")
```


## Correlation between Disability Difficulties

```{r}
pums_data_col %>%
  mutate(num_diff = DDRS + DEAR + DEYE + DOUT + DPHY + DREM) %>%
  group_by(num_diff) %>%
  summarise(count = sum(PWGTP)) %>%
  kable()

pums_data_col %>%
  select(DDRS, DEAR, DEYE, DOUT, DPHY, DREM) %>%
  cor() %>%
  corrplot(diag = FALSE, type = 'upper')
```

## Correlation of All Numeric Columns

```{r}
pums_data_col %>%
  select(AGEP, DDRS, DEAR, DEYE, DOUT, DPHY, DREM, SSIP, SSP, WAGP, PINCP, POVPIP, FSEMP) %>%
  cor() %>%
  corrplot(diag = FALSE, type = 'upper')
```

